<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/task_list.css" rel="stylesheet" />
	</head>

	<body>
		
			<div id="content1">
				<!--列表刷新-->
				<div id="pullrefresh" class=" mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mission_list_contant_add">
					
						</div>
					</div>
				</div>
			</div>
		
		<script src="js/immersed.js"></script>
		<script type="text/javascript" src="js/flexible.js"></script>
		<script src="js/jquery-1.11.1.js"></script>
		<script src="js/jquery-1.11.1.min.js"></script>
		<script type="text/javascript" src="js/config.js" ></script>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init({
 			pullRefresh: {
 //					容器
 					container: '#pullrefresh',
 					up: {
 						contentrefresh: '正在加载...',
 						callback: pullupRefresh
 					}
 					
 				}
			})
			if (mui.os.plus) {
 				mui.plusReady(function() {
 				setTimeout(function() {
 						mui('#pullrefresh').pullRefresh().pullupLoading();
 					}, 1000);
 
 				});
 			} else {
 				mui.ready(function() {
 					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
 			}
 			var ajaxUrl = 'http://www.mozotech.cn/bangbang/index/taskmanage/tasklist';
			var taskList =null;
			var count = 0;
			/**
 			 * 上拉加载具体业务实现
 			 */
   			function pullupRefresh() {
   				
   				setTimeout(function() {
   					$.ajax({
					async : false,
					type: "post",
					url: ajaxUrl,
					dataType: 'json',
					data: {
					},
					success: function(text) {
						taskList = text;
						console.log(taskList);
					},
					error: function(jqXHR) {
						alert("发生错误：" + jqXHR.status);
					}
				});
   					mui('#pullrefresh').pullRefresh().endPullupToRefresh(++count > 3); //参数为true代表没有更多数据了。
   					var table = document.body.querySelector('.mission_list_contant_add');
   					var cells = document.body.querySelectorAll('.mission_list_contant');
   					for (var i = 0, len = 5; i < len; i++) {
   						var div = document.createElement('div');
   						div.className = 'mission_list_contant';
   						if(taskList[i].sendusersex ==0)
   						{
   							div.innerHTML = "<div class='left_head'><div class='left_head_img'><img src="+'taskList[i].headimg'+"/></div></div><div class='right_contant'><div class='right_contant_top'><div class='right_contant_top_left'><p>"+ taskList[i].nickname +"</p><img class='top_left_img' src='img/sex.png' align='center' /></div><div class='right_contant_top_right'><img class='top_right_img' src='img/task_money.png' /><p>"+taskList[i].price+"</p></div></div><div class='right_contant_middle'><p>"+taskList[i].content+"</p></div><div class='right_contant_bottom'><div id='button1'onclick='task_detail()'>接受此单</div><div id='button2'>马上联系</div><div class='time'><p>"+taskList[i].time+"</p></div></div></div>";
   						}
   						else{
   							div.innerHTML = "<div class='left_head'><div class='left_head_img'><img src="+'taskList[i].headimg'+"/></div></div><div class='right_contant'><div class='right_contant_top'><div class='right_contant_top_left'><p>"+ taskList[i].nickname +"</p><img class='top_left_img' src='img/male.png' align='center' /></div><div class='right_contant_top_right'><img class='top_right_img' src='img/task_money.png' /><p>"+taskList[i].price+"</p></div></div><div class='right_contant_middle'><p>"+taskList[i].content+"</p></div><div class='right_contant_bottom'><div id='button1' onclick='task_detail()'>接受此单</div><div id='button2'>马上联系</div><div class='time'><p>"+taskList[i].time+"</p></div></div></div>";
   						}
   						table.appendChild(div);
   					}
   				}, 1500);
   			}
   			function task_detail(){
				openView.usuView('task_detail.html','task_detail.html'); 
			}
		</script>
	</body>

</html>